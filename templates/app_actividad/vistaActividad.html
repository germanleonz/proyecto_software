{% extends "app_usuarios/template.html" %}
{% load url from future %}
{% load staticfiles %}
{% block titulo %}Actividad "{{actividad.nombreact}}"{% endblock titulo %}
{% block css %}
<link href="{% static "css/vistaPizarra_style.css" %}" rel="stylesheet" type="text/css"/>
{% endblock css %}
{% block javascript %}
<script>
  $(document).ready(function(){
    dialog();
    barraUsuario();
  });
  $(function(){
    $( "#arbol" ).tabs();
  })
</script>
{% endblock javascript %}

{% block botones %}
<a id="crearActividad" onclick="Dajaxice.app_actividad.crearActividadForm(my_js_callbackActividad, {'data': {{pizarra.idpiz}}});" class="opcionesDer" href="#">Crear Actividad</a>
{% endblock botones %}
{% block cuerpo %}

<div id="columna">
  <table>
    <tr>
      <td>
        <h>Nombre</h></br>
        {{data}}
        {{actividad.nombreact}}
      </td>
    </tr>
    <tr>
      <td>
        <h>Creador</h></br>
        {{actividad.logincreador}}
      </td>
    </tr>
    <tr>
      <td>
        <h>Descripcion</h></br>
        {{actividad.descripcionact}}
      </td>
    </tr>
    <tr>
      <td>
        <h>Fecha inicial</h></br>
        {{actividad.fechainicial}}
      </td>
    </tr>
    <tr>
      <td>
        <h>Fecha de entrega</h></br>
        {{actividad.fechaentrega}}
      </td>
    </tr>
    <tr>
      <td>
        <h>Estado</h></br>
        {% if actividad.estadoact == "e" %}
        En ejecucion
        {% endif %}
        {% if actividad.estadoact == "r" %}
        Retrasada
        {% endif %}
        {% if actividad.estadoact == "p" %}
        Postergada
        {% endif %}
        {% if actividad.estadoact == "c" %}
        Completada
        {% endif %}
        {% if actividad.estadoact == "s" %}
        Sin asignar
        {% endif %}
      </td>
    </tr>
    <tr>
      <td>
        <!-- modificar actividad -->
        <form action="{% url 'app_actividad:modificar_form' %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="idact" value="{{actividad.idact}}"/>
          <input type="hidden" name="nombreact" value="{{actividad.nombreact}}"/>
          <input type="hidden" name="descripcionact" value="{{actividad.descripcionact}}"/>
          <input type="hidden" name="fechainicial" value="{{actividad.fechainicial}}"/>
          <input type="hidden" name="fechaentrega" value="{{actividad.fechaentrega}}"/>
          <input type="submit" id="modificarAct" value="Modificar" />
        </form>
      </td>
    </tr>
    <tr>
      <td>
        <!-- cambiar estado -->
        <form name="CambiarEstadoForm" action="{% url 'app_actividad:cambiar_estado_actividad' %}" method="post"> 
          {% csrf_token %}
          <select name="estadoact">
            <option value="null"> Estado </option>
            <option value="s"> Sin Asignar </option>
            <option value="c"> Completada </option>
            <option value="r"> Retrasada </option>
            <option value="e"> En Ejecucion </option>
            <option value="p"> Postergada </option>
          </select> 
          <input type="hidden" name="idact" value="{{actividad.idact}}"/>
          <input type="submit" value="Cambiar Estado" />
        </form>
      </td>
    </tr>
        <tr>
      <td>
        <form action="{% url 'app_actividad:crear_subactividad' %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="idact" value="{{actividad.idact}}"/>
	  <input type="hidden" name="idpiz" value="{{actividad.idpizactividad.idpiz}}"/>
          <input type="submit" id="modificarAct" value="Crear SubActividad" />
        </form>
      </td>
    </tr>
    <tr>
      <td>
        <form action="{% url 'app_actividad:asignar_actividad' %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="idact" value="{{actividad.idact}}"/>
	  <input type="hidden" name="idpiz" value="{{actividad.idpizactividad.idpiz}}"/>
	  <input type="hidden" name="nombreact" value="{{Actividad.nombreact}}" />
          <input type="submit" id="modificarAct" value="Asignar a otro" />
        </form>
      </td>
    </tr>
  </table>
</div>
<div id="arbol">
  <ul>
    <li><a href="#comentarios">Comentarios</a></li>
    <li><a href="#subactividades">Subactividades</a></li>
  </ul>
  <div id="comentarios">
    <table id="tablaComentarios">
      {% for elem in lista %}
      <tr>
        <td>
	    <form action="{% url 'app_comentarios:eliminar_comentario' %}" method="post">
	      {% csrf_token %}
	      {{elem.contenido}}
	      <br>
	      Fecha: {{elem.fechacomentario}}
	      Hora: {{elem.horacomentario}}
	      <br>
	      Autor: {{elem.loginusuario}}
	      <input type="hidden" name="idcomentario" value="{{elem.idcomentario}}"/>
	      <input type="submit" value="Eliminar"/>
	    </form>
        </td>
      </tr>
      {% endfor %}
    </table>
    <!-- hacer comentarios -->
    <div id="comentar">
    <form action="{% url 'app_comentarios:crear_comentario' %}" id="crear_comentario" method="post">{% csrf_token %}
      <input type="hidden" name="idact" value="{{actividad.idact}}"/>
      <textarea id="contenido" name="contenido"></textarea>
      <input type="submit" value="Comentar"/>
    </form>
  </div>
  </div>
  <div id="subactividades">
    <script>
      $(function() {
        $( ".actividad" ).draggable();
      });
    </script>
    <table id="tablaActividad">
      {% for object in listasub %}
      {% if forloop.counter0|divisibleby:"3"%}
      <tr>
        {% endif %}
        <td>
          <div class="actividad" style="
            {%if object.estadoact == "c"%}
            background: #378B6E;
            {%endif%}
            {%if object.estadoact == "r"%}
            background: #FFCC00;
            {%endif%}
            {%if object.estadoact == "e"%}
            background: #1947D1;
            {%endif%}
            {%if object.estadoact == "p"%}
            background: #FF0000;
            {%endif%}
            {%if object.estadoact == "s"%}
            background: #FFF;
            color: black;
            {%endif%}
            ">
            <div id="actHead">
              {{object.nombreact}}
            <!--  {# <form action="{% url 'app_actividad:eliminar_actividad' %}" method="post" onsubmit="if(!confirm('Seguro desea eliminar esta actividad?')) return false">
                {% csrf_token %}
                <input type="hidden" name="idact" value="{{object.idact}}"/>
                <input type="hidden" name="idpiz" id="idPizarra" value="{{pizarra.idpiz}}"/>
                <input class="borrar" type="submit" value=""/>
              </form>#} -->
            </div>
            <div class="mostrarActividad" id="actCont" onclick="divSubmit(this)">
              {{object.descripcionact}}
              <form action="{% url 'app_actividad:visualizar_actividad' %}" id="visualizarActividad" method="post">
                {% csrf_token %}
                <input type="hidden" name="idact" id="id_idact" value="{{object.idact}}"/>
              </form>
            </div>
          </div>
        </td>
        {% if forloop.counter|divisibleby:"3"%}
      </tr>
      {% endif %}
      {% endfor %}
    </table>

  </div>
</div>

{% endblock cuerpo%} 
